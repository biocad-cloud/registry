RewriteEngine On

# --- 以下是你原有的 Header 配置 (保持不变) ---
Header set Access-Control-Allow-Origin "*"

# cache images for 1 month, do not require revalidation
<FilesMatch "\.(gif|jpe?g|png|flv|swf|ico)$">
Header set Cache-Control: "max-age=1296000"
</FilesMatch>
#
# cache scripts, css, and documents for 1 week, do not require revalidation
<FilesMatch "\.(js|css|pdf)$">
Header set Cache-Control: "max-age=10800"
</FilesMatch>
#
# Cache txt, html, and htm pages for 1 week, require revalidation
<FilesMatch "\.(txt|html?)$">
Header set Cache-Control: "max-age=604800, must-revalidate"
</FilesMatch>
#
# disable caching for dynamic files
<FilesMatch "\.(pl|php|[sf]?cgi|spl)$">
Header set Cache-Control: "max-age=0, no-store"
</FilesMatch>
# --- Header 配置结束 ---

# 1. 如果请求的是 index.php，直接跳过重写（可选，但为了性能推荐保留）
RewriteCond %{REQUEST_URI} ^/index\.php
RewriteRule ^(.*)$ - [L]

# 2. 定义通用条件：请求的不是真实文件，也不是真实目录
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# 3. 处理带斜杠的请求 (例如 /home/ ) -> 去掉斜杠传给 app
# 注意：上面的条件对这条规则生效
RewriteRule ^(.+)/$ /index.php?app=$1 [L]

# 4. 处理普通请求 (例如 /home ) -> 传给 app
# 重要：必须再次声明条件，或者让这条规则共享上面的条件。
# 在 Apache 中，RewriteCond 默认只管一条规则。
# 所以我们需要再次复制条件，或者将两条规则合并。
# 为了清晰起见，这里再次加上条件：
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

RewriteRule ^(.+)$ /index.php?app=$1 [L]
